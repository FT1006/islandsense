# config.yaml - IslandSense MVP (7-day early warning design)

project:
  name: "IslandSense MVP"
  horizon_days: 7          # how far ahead the demo looks (calendar days)

data:
  sailings_file: "sailings.csv"
  status_file: "status.csv"
  metocean_file: "metocean.csv"
  tides_file: "tides.csv"
  exposure_file: "exposure_by_sailing.csv"   # optional; can be synthetic

label:
  disruption_delay_minutes: 120              # delay > 120 min treated as disruption

categories:
  fresh:
    label: "Fresh food"
    exposure_unit_label: "pallets"
  fuel:
    label: "Fuel"
    exposure_unit_label: "trailer-equivalents"

jdi:
  categories:
    fresh:
      expected_loss_min: 0.0
      expected_loss_max: 100.0
    fuel:
      expected_loss_min: 0.0
      expected_loss_max: 100.0
  bands:
    green:
      label: "Green"
      range: [0, 39]
    amber:
      label: "Amber"
      range: [40, 69]
    red:
      label: "Red"
      range: [70, 100]

scenarios:
  - id: "scenario_A"
    name: "Bring forward 10%"
    alpha:
      fresh: 0.20      # 20% effective reduction in E_loss for Fresh
      fuel: 0.15
  - id: "scenario_B"
    name: "Bring forward 10% + air-lift 5%"
    alpha:
      fresh: 0.30
      fuel: 0.25

scenario_selection:
  recommended_id: "scenario_A"   # MVP: always recommend A, show B as alternative
  auto_select: false             # no automatic Δ-threshold logic in MVP

impact:
  k_hours_per_unit: 0.25         # each shifted Fresh unit avoids ~0.25h of shelf-gap
  units_per_trailer: 24          # 1 "trailer-equivalent" = 24 units

# === M1.5: Prescriptive Economics (Config-Only) ===
# These parameters enable the optional tiny optimiser (M2.5) to compute
# scenario alphas by trading off penalty avoided vs action cost.
# If optimiser is not enabled, the static scenario alphas above are used.

costs:
  fresh:
    penalty_gap_per_unit_hour: 10.0      # £ per pallet-hour of shelf gap
    bring_forward_per_unit: 1.0          # £ per pallet brought forward
    air_per_unit: 4.0                    # £ per pallet air-lifted
  fuel:
    penalty_gap_per_trailer: 50.0        # £ per trailer-equivalent at risk
    bring_forward_per_unit: 2.0          # £ per trailer brought forward
    air_per_unit: 10.0                   # £ per trailer air-lifted (may be unused)

shift_limits:
  fresh:
    max_forward_fraction: 0.30           # max 30% of fresh volume can be brought forward
    max_air_fraction: 0.15               # max 15% of fresh volume can be air-lifted
  fuel:
    max_forward_fraction: 0.30           # max 30% of fuel volume can be brought forward
    max_air_fraction: 0.10               # max 10% of fuel volume can be air-lifted

budgets:
  fresh_air_units_per_week: 200.0        # soft cap on air-lifted fresh units/week
  fresh_forward_units_per_week: 600.0    # soft cap on brought-forward fresh units/week
  # fuel budgets optional for MVP

optimizer:
  enabled: true                          # set to true to use optimiser instead of static alphas

  # Cost per unit of disrupted exposure if we DON'T mitigate
  penalty_per_unit:
    fresh: 4.0                           # £ per unit-hour of shelf gap
    fuel: 3.0                            # £ per trailer-equivalent at risk

  # Operational cost per unit when we move/air-lift
  cost_forward:
    fresh: 0.05                          # £ per pallet brought forward
    fuel: 0.05                           # £ per trailer brought forward

  cost_air:
    fresh: 0.40                          # £ per pallet air-lifted
    fuel: 0.30                           # £ per trailer air-lifted

  # Effectiveness of each action in reducing at-risk exposure
  beta_forward:
    fresh: 0.7                           # 10% forward → 7% risk reduction
    fuel: 0.5                            # 10% forward → 5% risk reduction

  beta_air:
    fresh: 0.9                           # 10% air → 9% risk reduction
    fuel: 0.8                            # 10% air → 8% risk reduction

  # Hard caps: with linear objective, optimizer hits max if beneficial
  # So max_forward_fraction IS your recommended percentage
  shift_limits:
    fresh:
      max_forward_fraction: 0.10         # force "bring forward 10%"
      max_air_fraction: 0.00             # ban air in MVP (forces y=0)
    fuel:
      max_forward_fraction: 0.10
      max_air_fraction: 0.00

  # Grid to search over
  grid:
    forward_fractions: [0.0, 0.10]       # 0% vs 10% in MVP
    air_fractions: [0.0, 0.05, 0.10]     # kept for future; max_air=0 kills them

model:
  type: "xgboost"
  random_seed: 42
  test_size_fraction: 0.2
  training:
    max_depth: 3
    learning_rate: 0.05
    n_estimators: 100
    scale_pos_weight: 29.0
    # Monotonic constraints: [WOTDI, BSEF, gust_max_3h, tide_gate_margin, prior_24h_delay, day_of_week, month]
    monotone_constraints: [1, 1, 1, -1, 1, 0, 0]

ui:
  default_view_label: "7-day risk"
  show_what_if_sliders: false    # sliders are gone in the 7-day design
  show_download_brief: true
